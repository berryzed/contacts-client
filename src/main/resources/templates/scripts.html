<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8"/>
</head>
<body>
<th:block th:fragment="scripts">
    <script th:if="${alertMessage}" th:inline="javascript">
        /*[+
        alert([[${alertMessage}]]);
        +]*/
    </script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
            integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
            integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"></script>

    <script th:inline="javascript">
        /*<![CDATA[*/
        $('.btn-action').on('click', function () {
            var actionType = $(this).data('action');

            if ($(this).hasClass('disabled') || actionType == null) {
                return true;
            }

            var parentForm = $(this).closest('form');
            var actionURL = parentForm.data('url');
            var option = $(this).data('excel-option');

            if (actionType === 'excel') {
                exportExcel(actionURL + actionType, option);
            } else if (actionType === 'delete') {
                if (confirm('삭제된 데이터는 복구되지 않습니다.\n삭제하시겠습니까?')) {
                    // 삭제 불가능한 데이터는 보내지 않는다.
                    $('input.not-removable').prop('disabled', true);
                    parentForm.attr('action', actionURL + actionType);
                    parentForm.submit();
                }
            } else if (actionType === 'upload') {
                // $('#excelUploadFile').trigger('click');
            }
        });

        // Table의 전체선택 체크박스에 체크한 경우 자동 처리
        $('.form-check-all').change(function () {
            var parentTable = $(this).parents('table');
            var checkedVal = $(this).prop('checked');

            parentTable.find('tbody').find('.form-check-input:not(.not-all)').prop('checked', checkedVal);
        });

        /* 리스트 체크항목이 있는 지 여부를 검사 */
        $('.data-list').on('change', 'input[type="checkbox"]:not(.not-all)', function () {
            var checkedCnt = $('.data-list').find('input[type="checkbox"]:not(.form-check-all):not(.not-all):checked').length;
            var toggle = checkedCnt === 0;
            $('.data-list').find('.btn-require-selected').prop('disabled', toggle).toggleClass('disabled', toggle);
        });

        /* Form 전송 시 파라미터가 없는 경우를 대비하기 위한 예외 처리 코드 */
        $('.data-list').submit(function () {
            if ($(this).find('input[type="checkbox"]:not(.form-check-all):not(.not-all):checked').length === 0) {
                return false;
            }
        });
        /*]]>*/
    </script>
</th:block>
</body>
</html>
